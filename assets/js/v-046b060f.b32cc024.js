(self.webpackChunkts_test=self.webpackChunkts_test||[]).push([[140],{5046:(e,n,t)=>{"use strict";t.r(n),t.d(n,{data:()=>a});const a={key:"v-046b060f",path:"/chap1/1-1.html",title:"1.1 程序设计的基本元素",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"练习1.1",slug:"练习1-1",children:[]},{level:2,title:"练习1.4",slug:"练习1-4",children:[]}],filePathRelative:"chap1/1-1.md",git:{updatedTime:1621610185e3,contributors:[]}}},3697:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>ve});var a=t(6252),s=t(3577);const r=(0,a.uE)('<h1 id="_1-1-程序设计的基本元素"><a class="header-anchor" href="#_1-1-程序设计的基本元素">#</a> 1.1 程序设计的基本元素</h1><h2 id="练习1-1"><a class="header-anchor" href="#练习1-1">#</a> 练习1.1</h2><div class="language-scheme ext-scheme line-numbers-mode"><pre class="language-scheme"><code> <span class="token number">10</span>\n\n <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">5</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">9</span> <span class="token number">1</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token operator">/</span> <span class="token number">6</span> <span class="token number">2</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">2</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">4</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token keyword">define</span> a <span class="token number">3</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token keyword">define</span> b <span class="token punctuation">(</span><span class="token operator">+</span> a <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token operator">+</span> a b <span class="token punctuation">(</span><span class="token operator">*</span> a b<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token operator">=</span> a b<span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">and</span> <span class="token punctuation">(</span><span class="token operator">&gt;</span> b a<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span> b <span class="token punctuation">(</span><span class="token operator">*</span> a b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n     b\n     a<span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> a <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">6</span><span class="token punctuation">)</span>\n       <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> b <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">6</span> <span class="token number">7</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n       <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&gt;</span> b a<span class="token punctuation">)</span> b a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&gt;</span> a b<span class="token punctuation">)</span> a<span class="token punctuation">)</span>\n \t <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&lt;</span> a b<span class="token punctuation">)</span> b<span class="token punctuation">)</span>\n \t <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">(</span><span class="token operator">+</span> a <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div>',3),i=(0,a.uE)('<h2 id="练习1-4"><a class="header-anchor" href="#练习1-4">#</a> 练习1.4</h2><div class="language-scheme ext-scheme line-numbers-mode"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">a-plus-abs-b</span> a b<span class="token punctuation">)</span>\n    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&gt;</span> b <span class="token number">0</span><span class="token punctuation">)</span> + -<span class="token punctuation">)</span> a b<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token function">a-plus-abs-b</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token function">a-plus-abs-b</span> <span class="token number">2</span> <span class="token number">2</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>',2);var l,o;(o=l||(l={}))[o.Initial=1]="Initial",o[o.BracketsLeftRound=2]="BracketsLeftRound",o[o.BracketsRightRound=3]="BracketsRightRound",o[o.Comma=4]="Comma",o[o.Apostrophe=5]="Apostrophe",o[o.Dot=6]="Dot",o[o.Dot3=7]="Dot3",o[o.Comment=8]="Comment",o[o.StringBegin=9]="StringBegin",o[o.StringEscape=10]="StringEscape",o[o.Hash=11]="Hash",o[o.Boolean=12]="Boolean",o[o.CharBegin=13]="CharBegin",o[o.CharEscape=14]="CharEscape",o[o.Radix1=15]="Radix1",o[o.Radix2=16]="Radix2",o[o.Exactness1=17]="Exactness1",o[o.Exactness2=18]="Exactness2",o[o.Prefix=19]="Prefix",o[o.SignInit=20]="SignInit",o[o.Sign=21]="Sign",o[o.UrealR=22]="UrealR",o[o.UintegerRB=23]="UintegerRB",o[o.UintegerRE=24]="UintegerRE",o[o.DecimalB=25]="DecimalB",o[o.DecimalE=26]="DecimalE",o[o.SuffixB=27]="SuffixB",o[o.SuffixE=28]="SuffixE",o[o.SuffixNum=29]="SuffixNum",o[o.SuffixSign=30]="SuffixSign",o[o.Complex=31]="Complex",o[o.IdInit=32]="IdInit",o[o.Fail=33]="Fail",o[o.End=34]="End",o[o.Final=35]="Final";const u=class{constructor(e){this.Type=u.Type,this.Value=e}DisplayStr(){return"#"+(this.Value?"t":"f")}static isTrue(e){return e.Type!==u.Type||e.Value}equal(e){return e.Type===u.Type&&this.Value===e.Value}Copy(){return new u(this.Value)}};let p=u;p.Type="MyBool";class c{static MakeFromFloat(e){let n=new c;if(Number.isInteger(e))n.Numerator=e,n.Denominator=1;else{let t=e.toString().split(".");n.Denominator=Math.pow(10,t[1].length),n.Numerator=n.Denominator*Number.parseInt(t[0])+Number.parseInt(t[1]),n.reduce()}return n}static MakeFromInteger(e,n){let t=new c;return t.Numerator=e,t.Denominator=n,t.reduce(),t}static MakeFromRational(e){let n=new c;return Object.assign(n,e),n}toNumber(){return this.Numerator/this.Denominator}DisplayStr(){return 1===this.Denominator||0===this.Numerator?`${this.Numerator}`:`${this.Numerator}/${this.Denominator}`}reduce(){if(0===this.Numerator)return void(this.Denominator=1);let e=f(this.Numerator,this.Denominator);this.Denominator/=e,this.Numerator/=e,this.Denominator<0&&(this.Denominator*=-1,this.Numerator*=-1)}plus(e){this.Numerator*=e.Denominator,this.Numerator+=e.Numerator*this.Denominator,this.Denominator*=e.Denominator,this.reduce()}minus(e){this.Numerator*=e.Denominator,this.Numerator-=e.Numerator*this.Denominator,this.Denominator*=e.Denominator,this.reduce()}times(e){this.Numerator*=e.Numerator,this.Denominator*=e.Denominator,this.reduce()}div(e){this.Numerator*=e.Denominator,this.Denominator*=e.Numerator,this.reduce()}equal(e){return this.Numerator===e.Numerator&&this.Denominator===e.Denominator}}class d{static MakeFromFloat(e,n){let t=new d;return t.Value=e?c.MakeFromFloat(n):n,t}static MakeFromRational(e){let n=new d;return n.Value=e,n}static MakeFromReal(e,n){let t=new d;return e?n.Value instanceof c?t.Value=c.MakeFromRational(n.Value):t.Value=c.MakeFromFloat(n.Value):n.Value instanceof c?t.Value=n.Value.toNumber():t.Value=n.Value,t}DisplayStr(){return this.Value instanceof c?this.Value.DisplayStr():this.Value.toString()}Zero(){return 0===this.toNumber()}toNumber(){return this.Value instanceof c?this.Value.toNumber():this.Value}toInt(){return Number.parseInt(this.toNumber().toString())}plus(e){this.Value instanceof c?e.Value instanceof c?this.Value.plus(e.Value):this.Value=this.Value.toNumber()+e.toNumber():this.Value=this.Value+e.toNumber()}minus(e){this.Value instanceof c?e.Value instanceof c?this.Value.minus(e.Value):this.Value=this.Value.toNumber()-e.toNumber():this.Value=this.Value-e.toNumber()}equalS(e){return this.Value instanceof c?e.Value instanceof c?this.Value.equal(e.Value):this.Value.toNumber()===e.toNumber():this.Value===e.toNumber()}equal(e){return this.Value instanceof c?e.Value instanceof c&&this.Value.equal(e.Value):!(e.Value instanceof c)&&this.Value===e.toNumber()}times(e){this.Value instanceof c?e.Value instanceof c?this.Value.times(e.Value):this.Value=this.Value.toNumber()*e.toNumber():this.Value=this.Value*e.toNumber()}div(e){this.Value instanceof c?e.Value instanceof c?this.Value.div(e.Value):this.Value=this.Value.toNumber()/e.toNumber():this.Value=this.Value/e.toNumber()}}const h=class{constructor(){this.Type=h.Type,this.RealPart=d.MakeFromRational(c.MakeFromInteger(0,1)),this.UnRealPart=d.MakeFromRational(c.MakeFromInteger(0,1))}DisplayStr(){if(this.UnRealPart.Zero())return this.RealPart.DisplayStr();{let e=this.UnRealPart.DisplayStr();return`${this.RealPart.DisplayStr()}${"-"===e[0]?e:`+${e}`}i`}}plus(e){this.RealPart.plus(e.RealPart),this.UnRealPart.plus(e.UnRealPart)}minus(e){this.RealPart.minus(e.RealPart),this.UnRealPart.minus(e.UnRealPart)}equal(e){return e instanceof h&&this.RealPart.equal(e.RealPart)&&this.UnRealPart.equal(e.UnRealPart)}equalS(e){return this.RealPart.equalS(e.RealPart)&&this.UnRealPart.equalS(e.UnRealPart)}times(e){let n=new h;n.plus(this),n.RealPart.times(e.RealPart),n.UnRealPart.times(e.UnRealPart),n.RealPart.minus(n.UnRealPart),this.RealPart.times(e.UnRealPart),this.UnRealPart.times(e.RealPart),this.UnRealPart.plus(this.RealPart),this.RealPart=n.RealPart}div(e){let n=d.MakeFromFloat(!0,0);n.plus(e.RealPart),n.times(e.RealPart);let t=d.MakeFromFloat(!0,0);t.plus(e.UnRealPart),t.times(e.UnRealPart),n.plus(t);let a=new h;a.plus(this),a.RealPart.times(e.RealPart),a.UnRealPart.times(e.UnRealPart),a.RealPart.plus(a.UnRealPart),this.RealPart.times(e.UnRealPart),this.UnRealPart.times(e.RealPart),this.UnRealPart.minus(this.RealPart),this.RealPart=a.RealPart,this.RealPart.div(n),this.UnRealPart.div(n)}less(e){return this.RealPart.toNumber()<e.RealPart.toNumber()||this.RealPart.toNumber()===e.RealPart.toNumber()&&this.UnRealPart.toNumber()<e.UnRealPart.toNumber()}Copy(){let e=new h;return e.RealPart=this.RealPart,e.UnRealPart=this.UnRealPart,e}};let m=h;m.Type="Complex";const f=(e,n)=>0==e?n:f(n%e,e),b=class{constructor(){this.Type=b.Type}DisplayStr(){return`'${this.Value.DisplayStr()}`}equal(e){return e.Type===b.Type&&this.Value.equal(e.Value)}Copy(){let e=new b;return e.Value=this.Value.Copy(),e}};let k=b;k.Type="Quotation";const w=class{constructor(e){this.Type=w.Type,this.Value=e}DisplayStr(){return`${this.Value}`}equal(e){return e.Type===w.Type&&this.Value===e.Value}Copy(){return new w(this.Value)}};let y=w;y.Type="Identifier";const g=class{constructor(){this.Type=g.Type}DisplayStr(){return`"${this.Value}"`}equal(e){return e.Type===g.Type&&this.Value===e.Value}Copy(){let e=new g;return e.Value=this.Value,e}};let R=g;R.Type="MyString";const V=class{constructor(e){this.Type=V.Type,this.Value=e}DisplayStr(){return`#\\${this.Value}`}equal(e){return e.Type===V.Type&&this.Value===e.Value}Copy(){return new V(this.Value)}};let v=V;v.Type="MyChar";const S=class{constructor(){this.Type=S.Type,this.Value="("}DisplayStr(){return this.Value}};let T=S;T.Type="BracketsLeftRound";const x=class{constructor(){this.Type=x.Type,this.Value=")"}DisplayStr(){return this.Value}};let P=x;P.Type="BracketsRightRound";const E=class{constructor(){this.Type=E.Type,this.Value=","}DisplayStr(){return this.Value}};let F=E;F.Type="Comma";const D=class{constructor(){this.Type=D.Type,this.Value="'"}DisplayStr(){return this.Value}};let I=D;I.Type="Apostrophe";const N=class{constructor(){this.Type=N.Type,this.Value="."}DisplayStr(){return this.Value}};let U=N;U.Type="Dot";const C=class{constructor(){this.Type=C.Type,this.Value="..."}DisplayStr(){return this.Value}};let M=C;M.Type="Dot3";const B=class{constructor(e){this.Type=B.Type,this.Value=e}DisplayStr(){return this.Value}};let q=B;q.Type="Comment";const _=class{constructor(){this.Type=_.Type}DisplayStr(){return this.Value.DisplayStr()}};let $=_;$.Type="Char";const L=class{constructor(e){this.Type=L.Type,this.Value=new R,this.Value.Value=e}DisplayStr(){return this.Value.DisplayStr()}};let A=L;A.Type="String";const W=class{constructor(e){this.Type=W.Type,this.Value=new p(e)}DisplayStr(){return this.Value.DisplayStr()}};let O=W;O.Type="Boolean";class j{constructor(){this.sign=1,this.value="",this.suffix=""}generate(e,n){if(0===this.value.length)return{r:d.MakeFromRational(c.MakeFromInteger(0,1)),e:!0};let t=this.suffix.length>0?Number.parseInt(this.suffix):0;if(-1!==this.value.indexOf(".")){let n=this.sign*Number.parseFloat(this.value);return 1===e?{r:d.MakeFromFloat(!0,n),e:!0}:{r:d.MakeFromFloat(!1,n),e:!1}}if(-1!==this.value.indexOf("/")){let n=this.value.split("/"),t=Number.parseInt(n[0]),a=Number.parseInt(n[1]);return 2===e?{r:d.MakeFromFloat(!1,t/a),e:!1}:{r:d.MakeFromRational(c.MakeFromInteger(t,a)),e:!0}}{let n=this.sign*Number.parseInt(this.value)*Math.pow(10,t);return 1===e?{r:d.MakeFromFloat(!0,n),e:!0}:2===e||t<0?{r:d.MakeFromFloat(!1,n),e:!1}:{r:d.MakeFromRational(c.MakeFromInteger(n,1)),e:!0}}}}const Z=class{constructor(){this.Type=Z.Type,this.Radix=10,this.Exactness=0,this.Real=new j,this.UnReal=new j,this.Part=0}DisplayStr(){return this.Value.DisplayStr()}appendValue(e){0===this.Part?this.Real.value+=e:this.UnReal.value+=e}appendSuffix(e){0===this.Part?this.Real.suffix+=e:this.UnReal.suffix+=e}setSign(e){0===this.Part?this.Real.sign=e:this.UnReal.sign=e}generate(){let e=this.Real.generate(this.Exactness,this.Radix),n=this.UnReal.generate(this.Exactness,this.Radix),t=e.e&&n.e;this.Value=new m,this.Value.RealPart=d.MakeFromReal(t,e.r),this.Value.UnRealPart=d.MakeFromReal(t,n.r)}};let H=Z;H.Type="Complex";class z{constructor(e){this.Type=A.Type,this.Value=new y(e)}DisplayStr(){return this.Value.Value}}z.Type="Identifier";const G=["!","$","%","&","*","/",":","<","=",">","?","^","_","~"],Q=["+","-",".","@"],Y=new Map([[2,["0","1"]],[8,["0","1","2","3","4","5","6","7"]],[10,["0","1","2","3","4","5","6","7","8","9"]],[16,["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]]]),J=[" ","\t","\n","(",")",'"',"\t",""],K=new Map([["a","a"],["b","\b"],["n","\n"],["r","\r"],["v","\v"],["\\","\\"],["'","'"],['"','"']]);function X(e,n){return void 0!==e.find((e=>e===n))}function ee(e){return/^[a-zA-Z]$/.test(e)}function ne(e){return ee(e)||X(G,e)||X(Y.get(10),e)||X(Q,e)}function te(e){switch(e){case"":return l.Final;case" ":case"\t":case"\n":case"\r":return l.Initial;case"(":return l.BracketsLeftRound;case")":return l.BracketsRightRound;case";":return l.Comment;case",":return l.Comma;case".":return l.Dot;case"'":return l.Apostrophe;case'"':return l.StringBegin;case"#":return l.Hash;case"+":case"-":return l.Sign;default:return ee(e)||X(G,e)?l.IdInit:X(Y.get(10),e)?l.UrealR:l.Fail}}const ae=class{constructor(e,n){this.Type=ae.Type,this.first=e,this.second=n}DisplayStr(){let e="(";return void 0!==this.first&&(e+=this.first.DisplayStr()),void 0===this.second?e+=")":this.second instanceof ae?e+=" "+this.second.DisplayStr().slice(1):e+=" "+this.second.DisplayStr()+")",e}car(){return this.first}cdr(){return this.second}cadr(e){let n=this;for(let t=e.length-1;t>=0;t--){if(n.Type!==ae.Type)throw new Error(`Cons cadr error: not a pair after ${e.slice(t)}`);if("a"===e[t])n=n.car();else{if("d"!==e[t])throw new Error(`Cons cadr error: unexpected char ${e[t]}`);n=n.cdr()}}return n}toArray(){let e=new Array;return ae.null(this)||(e.push(this.car()),void 0!==this.second&&(this.second instanceof ae?e.push(...this.second.toArray()):e.push(this.second))),e}static List(...e){return 0===e.length?ae.nil():new ae(e[0],ae.List(...e.splice(1)))}static nil(){return new ae(void 0,void 0)}equal(e){return e.Type===ae.Type&&this.first===e.first&&this.second===e.second}static null(e){return void 0===e||void 0===e.first&&void 0===e.second}isList(){return!!ae.null(this)||this.second.Type===ae.Type&&this.second.isList()}Copy(){let e,n;return void 0!==this.first&&(e=this.first.Copy()),void 0!==this.second&&(n=this.second.Copy()),new ae(e,n)}};let se=ae;function re(e,n){let t,a;if(void 0===n){if(t=e.next(),t.done)return}else t=n;a=t.value;let s=()=>{if(t=e.next(),t.done&&a.Type!==q.Type)throw new Error("Datum parse error: unexpected EOF");a=t.value};for(;a.Type===q.Type;)if(s(),t.done)return;if(a.Type===I.Type){let n=new k;return n.Value=re(e),n}if(a.Type===T.Type){let n=new Array;for(;s(),P.Type!==a.Type;){let a=re(e,t);n.push(a)}for(let e=0;e<n.length;e++)if(n[e].Type===y.Type&&"."===n[e].Value&&(0===e||e!==n.length-2))throw new Error(" illegal use of `.`");return se.List(...n)}if(a.Type===O.Type||a.Type===H.Type||a.Type===$.Type||a.Type===A.Type||a.Type===z.Type)return a.Value;throw console.log(a),new Error("Datum parse error: unexpected token type")}function ie(e){return e.Type===v.Type||e.Type===R.Type||e.Type===m.Type||e.Type===p.Type}function le(e,n){if(e.Type===se.Type){let t=e.car();return t.Type===y.Type&&t.Value===n}return!1}se.Type="Cons";const oe=class{constructor(e,n,t,a){this.Type=oe.Type,this.primitive=e,this.parameters=n,this.body=t,this.env=a}DisplayStr(){return this.primitive?"basic_procedure":`(lambda (${this.parameters.map((e=>e.Value)).join(" ")}) ${this.body.DisplayStr()}`}equal(e){return this===e}Copy(){return new oe(this.primitive,void 0!==this.parameters?this.parameters.map((e=>e.Copy())):this.parameters,this.primitive?this.body:this.body.Copy(),this.env)}};let ue=oe;ue.Type="procedure";class pe{constructor(){this.map_=new Map,this.parent_=void 0}Get(e){if(this.map_.has(e))return this.map_.get(e);if(void 0===this.parent_)throw new Error(`undeclare ${e}`);return this.parent_.Get(e)}Set(e,n){this.map_.set(e,n)}MakeChild(){let e=new pe;return e.setParent(this),e}Parent(){return this.parent_}setParent(e){this.parent_=e}}function ce(e,n){let t=e.Copy();if(e.primitive){let t=e.body(n.toArray());return Re.getInstance().replace(e,t),t}return Re.getInstance().replace(e,t.body),fe(e,function(e,n,t){let a=e.MakeChild();for(let e=0;e<n.length;e++){const s=n[e];if("."===s.Value){if(e!==n.length-2)throw new Error("produce: unexpected identifier dot");break}if(se.null(t))throw new Error("produce: the expected number of arguments does not match the given number");a.Set(s.Value,t.car()),t=t.cdr()}if(n.length>=2&&"."===n[n.length-2].Value&&(a.Set(n[-1].Value,t),t=void 0),!se.null(t))throw new Error("produce: the expected number of arguments does not match the given number");return a}(t.env,t.parameters,n))}function de(e){return new ue(!0,void 0,(n=>{if(1!=n.length)throw new Error(`c${e}r : expected 1 arguments`);return n[0].cadr(e)}),void 0)}function he(){let e=new pe;e.Set("+",new ue(!0,void 0,(e=>{let n=new m;for(const t of e)n.plus(t);return n}),void 0)),e.Set("-",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error("- : expected at least 1 argument");let n=new m;e.length>1&&(n.plus(e[0]),n.plus(e[0]));for(const t of e)n.minus(t);return n}),void 0)),e.Set("*",new ue(!0,void 0,(e=>{let n=new m;n.RealPart=d.MakeFromFloat(!0,1);for(const t of e)n.times(t);return n}),void 0)),e.Set("/",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error("/ : expected at least 1 argument");let n=new m;n.RealPart=d.MakeFromFloat(!0,1),e.length>1&&(n.times(e[0]),n.times(e[0]));for(const t of e)n.div(t);return n}),void 0)),e.Set("=",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error("= : expected at least 1 argument");let n=e[0];for(const t of e)if(!n.equal(t))return new p(!1);return new p(!0)}),void 0)),e.Set("<",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error("< : expected at least 1 argument");let n=e[0];for(let t=1;t<e.length;t++){const a=e[t];if(!n.less(a))return new p(!1);n=a}return new p(!0)}),void 0)),e.Set("<=",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error("<= : expected at least 1 argument");let n=e[0];for(let t=1;t<e.length;t++){const a=e[t];if(!n.less(a)&&!n.equal(a))return new p(!1);n=a}return new p(!0)}),void 0)),e.Set(">",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error("> : expected at least 1 argument");let n=e[0];for(let t=1;t<e.length;t++){const a=e[t];if(n.less(a)||n.equal(a))return new p(!1);n=a}return new p(!0)}),void 0)),e.Set(">=",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error(">= : expected at least 1 argument");let n=e[0];for(let t=1;t<e.length;t++){const a=e[t];if(n.less(a))return new p(!1);n=a}return new p(!0)}),void 0)),e.Set("eq?",new ue(!0,void 0,(e=>{if(2!=e.length)throw new Error("eq? : expected 2 arguments");return void 0===e[0]||void 0===e[1]?new p(e[1]===e[0]):new p(e[1].equal(e[0]))}),void 0)),e.Set("equal?",new ue(!0,void 0,(e=>{if(2!=e.length)throw new Error("eq? : expected 2 arguments");return void 0===e[0]||void 0===e[1]?new p(e[1]===e[0]):new p(e[1].DisplayStr()===e[0].DisplayStr())}),void 0)),e.Set("nil",se.nil()),e.Set("number?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("number? : expected 1 arguments");return new p(void 0!==e[0]&&e[0].Type===m.Type)}),void 0)),e.Set("complex?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("complex? : expected 1 arguments");return new p(void 0!==e[0]&&e[0].Type===m.Type)}),void 0)),e.Set("real?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("complex? : expected 1 arguments");return new p(void 0!==e[0]&&e[0].Type===m.Type&&e[0].UnRealPart.Zero())}),void 0)),e.Set("rational?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("complex? : expected 1 arguments");return new p(void 0!==e[0]&&e[0].Type===m.Type&&e[0].UnRealPart.Zero()&&"number"!=typeof e[0].RealPart.Value)}),void 0)),e.Set("integer?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("complex? : expected 1 arguments");if(void 0!==e[0]&&e[0].Type===m.Type&&e[0].UnRealPart.Zero()){if("number"==typeof e[0].RealPart.Value){let n=e[0].RealPart.Value;return new p(Number.isInteger(n))}return new p(1===e[0].RealPart.Value.Denominator)}return new p(!1)}),void 0)),e.Set("quotient",new ue(!0,void 0,(e=>{if(2!=e.length)throw new Error("quotient : expected 2 arguments");let n=e[0].RealPart.toInt(),t=e[1].RealPart.toInt(),a=new m;return n-=n%t,a.RealPart=d.MakeFromRational(c.MakeFromInteger(n/t,1)),a}),void 0)),e.Set("remainder",new ue(!0,void 0,(e=>{if(2!=e.length)throw new Error("remainder : expected 2 arguments");let n=e[0].RealPart.toInt(),t=e[1].RealPart.toInt(),a=new m;return a.RealPart=d.MakeFromRational(c.MakeFromInteger(n%t,1)),a}),void 0)),e.Set("gcd",new ue(!0,void 0,(e=>{if(2!=e.length)throw new Error("gcd : expected 2 arguments");let n=e[0].RealPart.toInt(),t=e[1].RealPart.toInt(),a=new m;return a.RealPart=d.MakeFromRational(c.MakeFromInteger(f(n,t),1)),a}),void 0)),e.Set("lcm",new ue(!0,void 0,(e=>{if(2!=e.length)throw new Error("lcm : expected 2 arguments");let n=e[0].RealPart.toInt(),t=e[1].RealPart.toInt(),a=new m;return a.RealPart=d.MakeFromRational(c.MakeFromInteger(n/f(n,t)*t,1)),a}),void 0)),e.Set("not",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("not : expected 2 arguments");return new p(e[0].Type===p.Type&&!e[0].Value)}),void 0)),e.Set("pair?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("pair? : expected 1 arguments");return new p(e[0].Type===se.Type)}),void 0)),e.Set("cons",new ue(!0,void 0,(e=>{if(2!=e.length)throw new Error("cons : expected 2 arguments");return new se(e[0],e[1])}),void 0)),e.Set("car",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("car : expected 1 arguments");return e[0].car()}),void 0)),e.Set("cdr",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("cdr : expected 1 arguments");return e[0].cdr()}),void 0)),e.Set("null?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("cdr : expected 1 arguments");return new p(se.null(e[0]))}),void 0)),e.Set("list?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("list? : expected 1 arguments");return new p(e[0].isList())}),void 0)),e.Set("list",new ue(!0,void 0,(e=>{if(e.length<1)throw new Error("list : expected at least 1 arguments");return se.List(...e)}),void 0)),e.Set("symbol?",new ue(!0,void 0,(e=>{if(1!=e.length)throw new Error("symbol? : expected 1 arguments");return new p(e[0].Type===y.Type)}),void 0)),e.Set("display",new ue(!0,void 0,(e=>{for(const n of e)n instanceof R||n instanceof v?Re.getInstance().display(n.Value):Re.getInstance().display(n.DisplayStr())}),void 0)),e.Set("newline",new ue(!0,void 0,(e=>{Re.getInstance().display("\n")}),void 0));let n=n=>{for(let t=0;t<1<<n;t++){let a="";for(let e=0;e<n;e++)a+=0==(t>>e&1)?"a":"d";let s=`c${a}r`;e.Set(s,de(a))}};return n(2),n(3),n(4),e}function me(e,n){if(ie(e))return e;if(function(e){return e.Type===y.Type}(e)){let t=n.Get(e.Value);return t.Type!==ue.Type&&Re.getInstance().replace(e,t),t}if(function(e){return e.Type===k.Type}(e))return e.Value;if(!function(e){return le(e,"define")}(e)){if(function(e){return le(e,"if")}(e))return function(e,n){let t=me(function(e){return e.cadr("ad")}(e),n);if(p.isTrue(t)){let t=function(e){return e.cadr("add")}(e);return Re.getInstance().replace(e,t),me(e,n)}{let t=function(e){let n=e.cadr("ddd");if(!se.null(n)){if(!se.null(n.cdr()))throw new Error("if error: multiple expression");return n.car()}}(e);if(void 0!==t||t.Type!==se.Type||!se.null(t))return Re.getInstance().replace(e,t),me(e,n)}}(e,n);if(function(e){return le(e,"lambda")}(e))return function(e,n,t){return new ue(!1,e.toArray(),n,t)}(e.cadr("ad"),e.cadr("dd"),n);if(function(e){return le(e,"begin")}(e))return Re.getInstance().replace(e,e.cdr()),fe(e,n);if(function(e){return le(e,"cond")}(e)){let t=ye(e.cdr());return Re.getInstance().replace(e,t),me(e,n)}if(function(e){return le(e,"let")}(e))return function(e,n){let t=e.cdr(),a=t.car(),s=t.cdr(),r=new Array,i=new Array;for(;!se.null(a);){let e=a.car();if(r.push(e.car()),i.push(e.cadr("ad")),!se.null(e.cadr("dd")))throw new Error("let : multiple expression");a=a.cdr()}let l=me(ke(se.List(...r),s),n),o=se.List(...i);return Re.getInstance().replace(e,se.List(l,o)),o=ge(o,n),Re.getInstance().replace(e,l,!1),ce(e,o)}(e,n);if(function(e){return le(e,"and")}(e))return function(e,n){let t=e.cdr();if(se.null(t))return Re.getInstance().replace(e,new p(!0)),new p(!0);let a=t.car(),s=t.cdr();if(se.null(s)){Re.getInstance().replace(e,a);let t=ie(e),s=me(e,n);return t||Re.getInstance().replace(e,s),s}let r=be(a,new se(new y("and"),s),new p(!1));return Re.getInstance().replace(e,r),me(e,n)}(e,n);if(function(e){return le(e,"or")}(e))return function(e,n){let t=e.cdr();if(se.null(t))return Re.getInstance().replace(e,new p(!1)),new p(!1);let a=t.car(),s=t.cdr();if(se.null(s)){Re.getInstance().replace(e,a);let t=ie(e),s=me(e,n);return t||Re.getInstance().replace(e,s),s}a=me(a,n);let r=be(a,a,new se(new y("or"),s));return Re.getInstance().replace(e,r),me(e,n)}(e,n);if(function(e){return e.Type===se.Type}(e)){let t=me(e.car(),n),a=ge(e.cdr(),n);return Re.getInstance().replace(e,t,!1),ce(e,a)}throw new Error("Unknown expression type")}!function(e,n){let t=function(e){try{let n=e.cadr("ad");return n.Type===y.Type?n.Value:e.cadr("aad").Value}catch(e){throw new Error("definition error: miss definition-variable")}}(e),a=me(function(e){let n=0;try{if(e.cadr("ad").Type===y.Type){let t=e.cadr("dd");if(!se.null(t.cdr()))throw n=1,new Error;return t.car()}return ke(e.cadr("dad"),e.cadr("dd"))}catch(e){throw 1===n?new Error("definition error: multiple definition-value"):new Error("definition error: miss definition-value")}}(e),n);Re.getInstance().replace(e,se.List(new y("define"),new y(t),a)),n.Set(t,a)}(e,n)}function fe(e,n){return se.null(e.cdr())?(Re.getInstance().replace(e,e.car()),me(e,n)):(Re.getInstance().replace(e.car(),me(e.car(),n)),Re.getInstance().replace(e,e.cdr()),fe(e,n))}function be(e,n,t){return void 0===t||t.Type===se.Type&&se.null(t)?se.List(new y("if"),e,n):se.List(new y("if"),e,n,t)}function ke(e,n){return new se(new y("lambda"),new se(e,n))}function we(e){if(!se.null(e))return se.null(e.cdr())?e.car():new se(new y("begin"),e)}function ye(e){if(se.null(e))return se.nil();let n=e.car(),t=e.cdr();if(le(n,"else")){if(!se.null(t))throw new Error("cond : else clause isn't last");return we(n.cdr())}return be(n.car(),we(n.cdr()),ye(t))}function ge(e,n){if(se.null(e))return se.nil();let t=e.car();return ie(t),t=me(t,n),new se(t,ge(e.cdr(),n))}class Re{constructor(){}static getInstance(){return Re.instance||(Re.instance=new Re),Re.instance}subModel(e){this.cur_=e}subShow(){this.sub_&&void 0!==this.cur_&&(this.display_(this.cur_.DisplayStr()),this.display_("\n"))}display(e){this.display_(e)}replace(e,n,t=!0){Object.assign(e,n),Object.setPrototypeOf(e,Object.getPrototypeOf(n)),t&&this.subShow()}setDisplay(e){this.display_=e}setSub(e){this.sub_=e}}function Ve(e,n,t,a){let s=function*(e){let n,t,a=function*(e){for(const n of e)yield n}(e),s=l.Initial,r=1,i=1,o=()=>{s!==l.Fail&&s!==l.Final&&(n=a.next(),n.done||("\n"==n.value?(r++,i=1):i++))};for(o();;){let e=n.done?"":n.value;switch(s){case l.Initial:s=te(e),s===l.Sign||s===l.IdInit?t=new z(e):s===l.UrealR&&(t=new H,t.appendValue(e)),o();break;case l.BracketsLeftRound:t=new T,s=l.End;break;case l.BracketsRightRound:t=new P,s=l.End;break;case l.Comma:t=new F,s=l.End;break;case l.Dot:X(J,e)?(t=new U,s=l.End):"."===e?(s=l.Dot3,o()):s=l.Fail;break;case l.Dot3:"."===e?(o(),t=new M,s=l.End):s=l.Fail;break;case l.Apostrophe:t=new I,s=l.End;break;case l.Comment:void 0===t&&(t=new q("")),"\n"===e||""===e?s=l.End:t.Value+=e,o();break;case l.StringBegin:void 0===t&&(t=new A("")),"\\"===e?s=l.StringEscape:'"'===e?s=l.End:t.Value.Value+=e,o();break;case l.StringEscape:K.has(e)?(t.Value.Value+=K.get(e),o(),s=l.StringBegin):s=l.Fail;break;case l.Hash:switch(e){case"t":t=new O(!0),s=l.Boolean;break;case"f":t=new O(!1),s=l.Boolean;break;case"\\":t=new $,s=l.CharBegin;break;case"e":case"i":t=new H,s=l.Exactness1,t.Exactness="i"===e?2:1;break;case"b":case"o":case"d":case"x":t=new H,s=l.Radix1,"b"===e?t.Radix=2:"o"===e?t.Radix=8:"x"===e&&(t.Radix=16);break;default:s=l.Fail}o();break;case l.Boolean:s=X(J,e)?l.End:l.Fail;break;case l.CharBegin:t.Value=e,o(),s=X(J,e)?l.End:"s"===e||"n"===e?l.CharEscape:l.Fail;break;case l.CharEscape:const a="s"===t.Value?"pace":"ewline";for(const t of a){if(e!==t){s=l.Fail;break}o(),e=n.done?"":n.value}X(J,e)&&(s=l.Fail),s!==l.Fail&&(t.Value="s"===t.Value?" ":"\n",s=l.End);break;case l.Radix1:switch(e){case"#":s=l.Radix2;break;case"+":case"-":"-"===e&&t.setSign(-1),s=l.SignInit;break;default:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UrealR):s=l.Fail}o();break;case l.Radix2:switch(e){case"e":case"i":s=l.Prefix,t.Exactness="i"===e?2:1;break;default:s=l.Fail}break;case l.Exactness1:switch(e){case"#":s=l.Exactness2;break;case"+":case"-":"-"===e&&t.setSign(-1),s=l.SignInit;break;default:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UrealR):s=l.Fail}o();break;case l.Exactness2:switch(e){case"b":case"o":case"d":case"x":s=l.Prefix,"b"===e?t.Radix=2:"o"===e?t.Radix=8:"x"===e&&(t.Radix=16);break;default:s=l.Fail}break;case l.Prefix:switch(e){case"+":case"-":"-"===e&&t.setSign(-1),s=l.SignInit;break;default:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UrealR):s=l.Fail}o();break;case l.SignInit:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UrealR,o()):s=l.Fail;break;case l.Sign:if(X(J,e))s=l.End;else if(X(Y.get(10),e)){let n=t.Value;t=new H,"-"===n.Value&&t.setSign(-1),t.appendValue(e),s=l.UrealR,o()}else s=l.Fail;break;case l.UrealR:X(J,e)?s=l.End:(X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UrealR):"/"===e?(t.appendValue(e),s=l.UintegerRB):"+"===e||"-"===e||"@"===e?0===t.Part?(t.Part=1,"-"===e&&t.setSign(-1),s=l.Complex):s=l.Fail:"e"===e?10!==t.Radix?s=l.Fail:(t.appendValue(e),s=l.SuffixE):"."===e?10!==t.Radix?(t.appendValue(e),s=l.Fail):(t.appendValue(e),s=l.DecimalB):s="i"===e&&1===t.Part?l.End:l.Fail,o());break;case l.UintegerRB:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UintegerRE):s=l.Fail,o();break;case l.UintegerRE:X(J,e)?s=l.End:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UintegerRE,o()):"+"===e||"-"===e||"@"===e?0===t.Part?(t.Part=1,"-"===e&&t.setSign(-1),s=l.Complex,o()):s=l.Fail:"e"===e?10!==t.Radix?s=l.Fail:(t.appendValue(e),s=l.SuffixE,o()):"i"===e&&1===t.Part?(s=l.End,o()):s=l.Fail;break;case l.DecimalB:X(Y.get(10),e)?(t.appendValue(e),s=l.UintegerRE):s=l.Fail,o();break;case l.DecimalE:X(J,e)?s=l.End:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UintegerRE,o()):0===t.Part?(t.Part=1,"-"===e&&t.setSign(-1),s=l.Complex,o()):s=l.Fail;break;case l.SuffixE:X(Y.get(10),e)?(t.appendSuffix(e),s=l.SuffixNum):"+"===e||"-"===e?(t.appendSuffix(e),s=l.SuffixSign):s=l.Fail,o();break;case l.SuffixNum:X(J,e)?s=l.End:X(Y.get(10),e)?(t.appendSuffix(e),s=l.SuffixNum,o()):0===t.Part?(t.Part=1,"-"===e&&t.setSign(-1),s=l.Complex,o()):s=l.Fail;break;case l.SuffixSign:X(Y.get(10),e)?(t.appendSuffix(e),s=l.SuffixNum):s=l.Fail,o();break;case l.Complex:X(Y.get(t.Radix),e)?(t.appendValue(e),s=l.UrealR):"i"===e?(t.appendValue("1"),s=l.End):s=l.Fail,o();break;case l.IdInit:X(J,e)?s=l.End:ne(e)?(t.Value.Value+=e,s=l.IdInit,o()):s=l.Fail;break;case l.End:t.Type===H.Type&&t.generate(),yield t,t=void 0,s=l.Initial}if(s===l.Fail)throw new Error(`editor:${r}:${i}: read-syntax:`);if(s===l.Final)break}}(e);Re.getInstance().setDisplay(n),Re.getInstance().setSub(t);try{for(;;){let e=re(s);if(void 0===e)break;Re.getInstance().subModel(e),Re.getInstance().subShow();let n=me(e,a);void 0!==n&&Re.getInstance().display(n.DisplayStr()),Re.getInstance().display("\n")}}catch(e){Re.getInstance().display(e)}}const ve={data:()=>({msg:{1:"",2:""},env:he(),codes:{1:"\n 10\n\n (+ 5 3 4)\n\n (- 9 1)\n\n (/ 6 2)\n\n (+ (* 2 4) (- 4 6))\n\n (define a 3)\n\n (define b (+ a 1))\n\n (+ a b (* a b))\n\n (= a b)\n\n (if (and (> b a) (< b (* a b)))\n     b\n     a)\n\n (cond ((= a 4) 6)\n       ((= b 4) (+ 6 7 a))\n       (else 25))\n\n (+ 2 (if (> b a) b a))\n\n (* (cond ((> a b) a)\n \t ((< a b) b)\n \t (else -1))\n    (+ a 1))\n",2:"\n(define (a-plus-abs-b a b)\n    ((if (> b 0) + -) a b))\n(a-plus-abs-b 2 (- 2))\n(a-plus-abs-b 2 2)\n"}}),created(){},methods:{runBase(e){this.clear(e),Ve(this.codes[e],(n=>{this.msg[e]=this.msg[e]+n}),!1,this.env)},runSub(e){this.clear(e),Ve(this.codes[e],(n=>{this.msg[e]=this.msg[e]+n}),!0,this.env)},clear(e){this.msg[e]=""}},render:function(e,n,t,l,o,u){return(0,a.wg)(),(0,a.j4)(a.HY,null,[r,(0,a.Wm)("div",null,[(0,a.Wm)("button",{onClick:n[1]||(n[1]=e=>u.runBase("1"))},"运行"),(0,a.Wm)("button",{onClick:n[2]||(n[2]=e=>u.runSub("1"))},"代换"),(0,a.Wm)("button",{onClick:n[3]||(n[3]=e=>u.clear("1"))},"清除")]),(0,a.Wm)("pre",null," "+(0,s.zw)(o.msg[1])+" ",1),i,(0,a.Wm)("div",null,[(0,a.Wm)("button",{onClick:n[4]||(n[4]=e=>u.runBase("2"))},"运行"),(0,a.Wm)("button",{onClick:n[5]||(n[5]=e=>u.runSub("2"))},"代换"),(0,a.Wm)("button",{onClick:n[6]||(n[6]=e=>u.clear("2"))},"清除")]),(0,a.Wm)("pre",null," "+(0,s.zw)(o.msg[2])+" ",1)],64)}}}}]);